---
applyTo: "backend/**,frontend/**,storage/**"
---

# 前后端及存储模块开发与审查规范

此文档针对 `backend/`、`frontend/` 及 `storage/` 目录的代码变更提供深度指引。

## 核心规范 (Core Requirements)

### 总体与安全
- **敏感信息泄露**: 严禁在代码中硬编码密钥、Token、密码或内网 IP 等敏感信息。
- **风格一致性**: 新代码必须与既有代码风格保持高度一致，严禁引入严重偏离项目习惯的风格。
- **文档与配置同步**: 
  - 涉及新功能上线或重大变更时，必须同步修订 `website/` 下的文档。
  - 涉及配置结构更新时，必须同步更新 `charts/` 配置文件并提升版本号。

### 后端 (Backend & Storage)
- **权限与路由**: 管理员接口必须注册到 `Admin` 路由，用户接口必须注册到 `Protected` 路由。
- **API 文档**: 变更外部 API 必须同步更新 `swag` 注释。
- **存储安全**: 严禁在 `storage/` 模块或 DAO 层拼接 SQL 字符串，必须使用参数化查询。
- **错误响应**: 必须使用符合 RESTful 规范的 HTTP 状态码，且返回给前端的错误信息必须为清晰、准确的英文。

### 前端 (Frontend)
- **组件复用**: 优先复用 `src/components/ui-custom/`（样式层）及 `src/components/`（业务层）的已有组件。
- **公共组件修改**: 修改被广泛引用的公共组件必须经过风险评估，严禁草率变更。
- **多语言**: 禁止硬编码文本，必须接入项目的多语言支持方案。
- **管理员视图判断**: 必须使用 `useIsAdmin()` Hook 进行判断。

## 优化建议 (Optimization Suggestions)

### 后端 (Backend & Storage)
- **命名规范**: 区分用户和管理员接口，比如管理员接口的函数名增加 `Admin` 前缀，普通用户接口的函数名增加 `User` 前缀。
- **架构解耦**: 建议将复杂的业务逻辑剥离至 Service 层，Handler 层仅负责请求分发与响应。
- **业务码精准化**: 建议在 `backend/internal/resputil/code.go` 中定义并使用更精准的业务状态码。
- **性能改进**: 针对算法或数据结构提出非瓶颈性的优化方案。
- **命名语义化**: 进一步优化变量名或函数名以增强代码自解释性。

### 前端 (Frontend)
- **移动端适配**: 建议针对窄屏幕（移动端）的显示效果进行响应式优化。
- **防重复提交**: 对于耗时可能较长的非幂等请求（如提交表单、创建资源等），建议增加 Loading 状态并禁用相关操作按钮，以避免用户重复操作。

## 补充说明 (Supplemental Instructions)

### `code-review` (审查助手)
- **高风险组件监控**: 凡涉及前端 `src/components/ui-custom/` 或其他被广泛复用的基础组件变更，必须在 Review 评论中将其列为“核心规范”项。要求开发者在评论中明确确认该变更对现有引用页面的影响范围及兼容性。
- **后端审查力度控制**: 在针对后端代码提出优化建议时应保持审慎（保守态度）。仅在发现明显的架构违规、重大性能隐患或具有高度参考价值的最佳实践时才进行评论，避免由于微小的个人风格差异或非关键性优化导致 Review 评论过于冗余。