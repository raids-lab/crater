---
title: Ingress-NGINX éƒ¨ç½²æŒ‡å—
description: Crater ä½¿ç”¨ Ingress-NGINX æ§åˆ¶å™¨æ¥ç®¡ç†æœåŠ¡çš„å¤–éƒ¨è®¿é—®ï¼Œä½œä¸º HTTP å’Œ HTTPS æµé‡çš„ä¸»è¦å…¥å£ç‚¹ã€‚
---

## éƒ¨ç½²

### é€‰é¡¹ 1ï¼šä¸ä½¿ç”¨ LoadBalancerï¼ˆä¾‹å¦‚è£¸é‡‘å±æˆ–å¼€å‘é›†ç¾¤ï¼‰

åœ¨ä¸æ”¯æŒ LoadBalancer æœåŠ¡ç±»å‹çš„é›†ç¾¤ä¸­ï¼Œæˆ‘ä»¬å»ºè®®å¯ç”¨ `hostNetwork` æ¨¡å¼ã€‚

```bash
helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
helm repo update

helm upgrade --install ingress-nginx ingress-nginx \
  --repo https://kubernetes.github.io/ingress-nginx \
  --namespace ingress-nginx \
  --create-namespace \
  --version 4.11.3 \
  --set controller.image.registry="crater-harbor.act.buaa.edu.cn/registry.k8s.io" \
  --set controller.admissionWebhooks.patch.image.registry="crater-harbor.act.buaa.edu.cn/registry.k8s.io" \
  --set controller.hostNetwork=true \
  --set controller.dnsPolicy=ClusterFirstWithHostNet \
  --set controller.healthCheckHost="10.109.80.4" \
  --set 'controller.nodeSelector.kubernetes\.io/hostname=cnode1' \
  --set "controller.tolerations="
```

ğŸ”§ æ ¹æ®ä½ çš„é›†ç¾¤èŠ‚ç‚¹é…ç½®è°ƒæ•´èŠ‚ç‚¹é€‰æ‹©å™¨ã€å®¹å¿åº¦å’Œ healthCheckHostã€‚

é€‰é¡¹ 2ï¼šä½¿ç”¨ MetalLBï¼ˆCrater æ¨èï¼‰
åœ¨æˆ‘ä»¬çš„ç”Ÿäº§é›†ç¾¤ä¸­ï¼ŒCrater ä½¿ç”¨ MetalLB åœ¨ Layer 2 æ¨¡å¼ä¸‹åˆ†é…å†…éƒ¨ IPã€‚Ingress æ§åˆ¶å™¨ä½œä¸º LoadBalancer æœåŠ¡éƒ¨ç½²ï¼Œè·å¾—ä¸€ä¸ªå†…éƒ¨ IPã€‚

```bash
helm upgrade --install ingress-nginx ingress-nginx/ingress-nginx \
  --namespace ingress-nginx \
  --create-namespace \
  --version 4.11.3 \
  --set controller.image.registry="crater-harbor.act.buaa.edu.cn/registry.k8s.io" \
  --set controller.admissionWebhooks.patch.image.registry="crater-harbor.act.buaa.edu.cn/registry.k8s.io" \
  --set controller.allowSnippetAnnotations=true
```

ğŸ“Œ æ­¤é…ç½®ä½¿ç”¨ MetalLB æ± ä¸­çš„ä¸€ä¸ªå†…éƒ¨ IPï¼Œå¹¶æ”¯æŒåœ¨å—ä¿¡ä»»ç½‘ç»œï¼ˆä¾‹å¦‚å¤§å­¦å†…ç½‘ï¼‰ä¸­çš„æœåŠ¡å‘ç°ã€‚

ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤éªŒè¯å¤–éƒ¨ IP çš„åˆ†é…ï¼š
```bash
kubectl get svc -n ingress-nginx
```

ç¤ºä¾‹ï¼š

```bash
NAME                       TYPE           EXTERNAL-IP       PORT(S)
ingress-nginx-controller   LoadBalancer   192.168.100.243   80:31234/TCP,443:31235/TCP
```

# ç‰ˆæœ¬å…¼å®¹æ€§è¯´æ˜
æˆ‘ä»¬ç›®å‰ **å°† Ingress-NGINX ç‰ˆæœ¬å›ºå®šä¸º `4.11.3`**ï¼Œå› ä¸º Crater çš„ Ingress æ³¨è§£å°šæœªä¸ç‰ˆæœ¬ â‰¥ `4.12.0` å…¼å®¹ã€‚å°è¯•ä½¿ç”¨æ–°ç‰ˆæœ¬å°†å¯¼è‡´è·¯ç”±é‡å†™é”™è¯¯ã€‚

# å¸è½½
è¦ç§»é™¤ Ingress æ§åˆ¶å™¨ï¼š

```bash
helm uninstall ingress-nginx -n ingress-nginx
```
# å‚è€ƒèµ„æ–™

* [Ingress-NGINX Helm Chart](https://github.com/kubernetes/ingress-nginx)

* [Crater å…¼å®¹æ€§è¯´æ˜](../README.md)