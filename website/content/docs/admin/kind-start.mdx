---
title: æœ€å°åŒ–éƒ¨ç½²
description: æœ¬æ–‡æ¡£å°†æŒ‡å¯¼æ‚¨ä½¿ç”¨ Kind åœ¨æœ¬åœ°å¿«é€Ÿæ­å»ºä¸€ä¸ª Crater ç¯å¢ƒã€‚Crater æ˜¯ä¸€ä¸ªåŸºäº Kubernetes çš„åˆ†å¸ƒå¼è®­ç»ƒå¹³å°ï¼Œæœ¬æŒ‡å—å°†æ¶µç›–ä»åˆ›å»º Kind é›†ç¾¤åˆ°éƒ¨ç½² Crater æ‰€éœ€å„ç»„ä»¶çš„å®Œæ•´æµç¨‹ã€‚
---

## 1. ç¯å¢ƒå‡†å¤‡

### 1.1 å®‰è£… Kind

<Callout type="info">
å‚è€ƒæ–‡æ¡£ï¼šhttps://kind.sigs.k8s.io/docs/user/quick-start/
</Callout>

```bash
# å®‰è£… Kind
curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.20.0/kind-linux-amd64
chmod +x ./kind
sudo mv ./kind /usr/local/bin/kind
```

<Callout type="info">
    å¦‚æœé‡åˆ°æƒé™é—®é¢˜ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨ `sudo` æˆ–å°† Kind ç§»åŠ¨åˆ°æœ‰å†™å…¥æƒé™çš„ç›®å½•
</Callout>

### 1.2 å®‰è£… kubectl å’Œ Helm

```bash
# å®‰è£… kubectl
curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
chmod +x kubectl
sudo mv kubectl /usr/local/bin/

# å®‰è£… Helm
curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash
```

## 2. åˆ›å»º Kind é›†ç¾¤

### 2.1 åˆ›å»ºé›†ç¾¤é…ç½®æ–‡ä»¶

<Callout type="info">
å‚è€ƒæ–‡æ¡£ï¼šhttps://kind.sigs.k8s.io/docs/user/ingress/
</Callout>

```yaml
# kind-cluster.yaml
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
  - role: control-plane
  - role: worker
    extraPortMappings:
    - containerPort: 80
      hostPort: 8080
      protocol: TCP
    - containerPort: 443
      hostPort: 8443
      protocol: TCP
```

<Callout type="info">
    ç«¯å£æ˜ å°„é…ç½®å…è®¸ä»ä¸»æœºè®¿é—®é›†ç¾¤å†…çš„æœåŠ¡ï¼Œè¿™å¯¹äº Ingress æ§åˆ¶å™¨ç‰¹åˆ«é‡è¦
</Callout>

### 2.2 åˆ›å»ºé›†ç¾¤

```bash
kind create cluster --config kind-cluster.yaml
```

**é¢„æœŸç»“æœï¼š**
```
Creating cluster "kind" ...
 âœ“ Ensuring node image (kindest/node:v1.27.3) ğŸ–¼
 âœ“ Preparing nodes ğŸ“¦ ğŸ“¦
 âœ“ Writing configuration ğŸ“œ
 âœ“ Starting control-plane ğŸ•¹ï¸
 âœ“ Installing CNI ğŸ”Œ
 âœ“ Installing StorageClass ğŸ’¾
 âœ“ Joining worker nodes ğŸšœ
Set kubectl context to "kind-kind"
You can now use your cluster with:
kubectl cluster-info --context kind-kind
```

## 3. éƒ¨ç½²ç”¨äº Kind é›†ç¾¤çš„ Ingress-Nginx

<Callout type="info">
    å‚è€ƒæ–‡æ¡£ï¼šhttps://kind.sigs.k8s.io/docs/user/ingress/
</Callout>

```bash
kubectl apply -f https://kind.sigs.k8s.io/examples/ingress/deploy-ingress-nginx.yaml
```

**éªŒè¯å®‰è£…ï¼š**
```bash
kubectl wait --namespace ingress-nginx \
  --for=condition=ready pod \
  --selector=app.kubernetes.io/component=controller \
  --timeout=90s
```

## 4. éƒ¨ç½² PostgreSQL æ•°æ®åº“

<Callout type="info">
    å‚è€ƒæ–‡æ¡£ï¼šhttps://artifacthub.io/packages/helm/bitnami/postgresql
</Callout>

```bash
# åˆ›å»ºå‘½åç©ºé—´
kubectl create namespace crater-system

# è®¾ç½®å½“å‰å‘½åç©ºé—´ä¸Šä¸‹æ–‡
kubectl config set-context --current --namespace=crater-system

# æ·»åŠ  Bitnami Helm ä»“åº“
helm repo add bitnami https://charts.bitnami.com/bitnami

# å®‰è£… PostgreSQL
helm install crater-postgresql bitnami/postgresql -n crater-system
```

**è·å–æ•°æ®åº“å¯†ç ï¼š**
```bash
export POSTGRES_PASSWORD=$(kubectl get secret --namespace crater-system crater-postgresql -o jsonpath="{.data.postgres-password}" | base64 -d)
echo "æ•°æ®åº“å¯†ç : $POSTGRES_PASSWORD"
```

<Callout type="info">
    è¯·å¦¥å–„ä¿å­˜æ•°æ®åº“å¯†ç ï¼Œåç»­éƒ¨ç½² Crater æ—¶éœ€è¦ç”¨åˆ°
</Callout>

## 5. éƒ¨ç½² Volcano è°ƒåº¦å™¨

<Callout type="info">
    å‚è€ƒæ–‡æ¡£ï¼šhttps://volcano.sh/zh/docs/v1.11.0/installation/
</Callout>

```bash
# æ·»åŠ  Volcano Helm ä»“åº“
helm repo add volcano-sh https://volcano-sh.github.io/helm-charts

# åˆ›å»ºå‘½åç©ºé—´å¹¶å®‰è£… Volcano
helm install volcano volcano-sh/volcano -n volcano-system --create-namespace
```

**éªŒè¯å®‰è£…ï¼š**
```bash
kubectl get pods -n volcano-system
```

**é¢„æœŸç»“æœï¼š**
```
NAME                                   READY   STATUS    RESTARTS   AGE
volcano-admission-xxxxxxxxx-xxxxx     1/1     Running   0          1m
volcano-controllers-xxxxxxxx-xxxxx    1/1     Running   0          1m
volcano-scheduler-xxxxxxxx-xxxxx      1/1     Running   0          1m
```

## 6. éƒ¨ç½² NFS å­˜å‚¨

<Callout type="info">
    å‚è€ƒæ–‡æ¡£ï¼šhttps://github.com/kubernetes-sigs/nfs-ganesha-server-and-external-provisioner
</Callout>

```bash
# æ·»åŠ  NFS Provisioner Helm ä»“åº“
helm repo add nfs-ganesha-server-and-external-provisioner https://kubernetes-sigs.github.io/nfs-ganesha-server-and-external-provisioner/

# å®‰è£… NFS Server Provisioner
helm install nfs-provisioner nfs-ganesha-server-and-external-provisioner/nfs-server-provisioner -n nfs-system --create-namespace
```

**éªŒè¯å­˜å‚¨ç±»ï¼š**
```bash
kubectl get storageclass
```

**é¢„æœŸç»“æœï¼š**
```
NAME   PROVISIONER                                       RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE
nfs    cluster.local/nfs-provisioner-nfs-server-provisioner   Delete          Immediate           true                   1m
```

## 7. éƒ¨ç½² Crater

### 7.1 è·å– Crater Helm Chart å€¼æ–‡ä»¶

```bash
helm show values oci://ghcr.io/raids-lab/crater --version 0.1.0 > values.yaml
```

### 7.2 é…ç½®æ•°æ®åº“è¿æ¥

ç¼–è¾‘ `values.yaml` æ–‡ä»¶ï¼Œé…ç½®æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼š

```yaml
postgres:
  host: crater-postgresql.crater-system.svc.cluster.local
  port: 5432
  dbname: postgres
  user: postgres
  password: "æ‚¨çš„æ•°æ®åº“å¯†ç "  # æ›¿æ¢ä¸ºå®é™…çš„å¯†ç 
  sslmode: disable
  TimeZone: Asia/Shanghai
```

### 7.3 å®‰è£… Crater

```bash
helm install crater oci://ghcr.io/raids-lab/crater --version 0.1.0 -n crater-system -f values.yaml
```

**éªŒè¯å®‰è£…ï¼š**
```bash
kubectl get pods -n crater-system
```

<Callout type="success">
    å¦‚æœæ‰€æœ‰ Pod éƒ½å¤„äº Running çŠ¶æ€ï¼Œè¯´æ˜ Crater ç¯å¢ƒå·²æˆåŠŸæ­å»ºï¼
</Callout>

## 8. è®¿é—® Crater

### 8.1 è·å–è®¿é—®åœ°å€

```bash
kubectl get ingress -n crater-system
```

### 8.2 é…ç½®æœ¬åœ° hostsï¼ˆå¦‚æœéœ€è¦ï¼‰

å¦‚æœä½¿ç”¨æœ¬åœ° Kind é›†ç¾¤ï¼Œå¯èƒ½éœ€è¦åœ¨ `/etc/hosts` ä¸­æ·»åŠ æ˜ å°„ï¼š

```
127.0.0.1 crater.example.com
```

### 8.3 è®¿é—® Web ç•Œé¢

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š`http://crater.example.com:8080`ï¼ˆæˆ–æ ¹æ®æ‚¨çš„ Ingress é…ç½®ï¼‰

## 9. æ•…éšœæ’é™¤

### 9.1 å¸¸è§é—®é¢˜

<Callout type="warn">
    **é—®é¢˜ï¼š** Pod æ— æ³•å¯åŠ¨æˆ–æŒç»­é‡å¯
</Callout>

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æŸ¥çœ‹ Pod æ—¥å¿—
kubectl logs <pod-name> -n crater-system

# æŸ¥çœ‹ Pod è¯¦ç»†ä¿¡æ¯
kubectl describe pod <pod-name> -n crater-system
```

<Callout type="warn">
    **é—®é¢˜ï¼š** æ•°æ®åº“è¿æ¥å¤±è´¥
</Callout>

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ£€æŸ¥æ•°æ®åº“æœåŠ¡çŠ¶æ€
kubectl get svc -n crater-system | grep postgres

# æµ‹è¯•æ•°æ®åº“è¿æ¥
kubectl run postgres-test --rm -it --image=postgres:13 --restart=Never -- \
  psql -h crater-postgresql.crater-system.svc.cluster.local -U postgres
```

## 10. æ¸…ç†ç¯å¢ƒ

```bash
# åˆ é™¤ Kind é›†ç¾¤
kind delete cluster

# æˆ–è€…åˆ é™¤ç‰¹å®šèµ„æº
helm uninstall crater -n crater-system
helm uninstall crater-postgresql -n crater-system
helm uninstall volcano -n volcano-system
helm uninstall nfs-provisioner -n nfs-system
```

<Callout type="warn">
    åˆ é™¤é›†ç¾¤ä¼šæ¸…é™¤æ‰€æœ‰æ•°æ®ï¼Œè¯·ç¡®ä¿å·²å¤‡ä»½é‡è¦æ•°æ®
</Callout>

## æ€»ç»“

é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨å·²ç»æˆåŠŸåœ¨ Kind é›†ç¾¤ä¸Šéƒ¨ç½²äº†ä¸€ä¸ªå®Œæ•´çš„ Crater ç¯å¢ƒï¼ŒåŒ…æ‹¬ï¼š

- âœ… Kind Kubernetes é›†ç¾¤
- âœ… Ingress-Nginx æ§åˆ¶å™¨
- âœ… PostgreSQL æ•°æ®åº“
- âœ… Volcano è°ƒåº¦å™¨
- âœ… NFS å­˜å‚¨ provisioner
- âœ… Crater è®­ç»ƒå¹³å°

ç°åœ¨æ‚¨å¯ä»¥å¼€å§‹ä½¿ç”¨ Crater è¿›è¡Œåˆ†å¸ƒå¼è®­ç»ƒä»»åŠ¡äº†ï¼å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·å‚è€ƒå„ç»„ä»¶çš„å®˜æ–¹æ–‡æ¡£æˆ–æŸ¥çœ‹æ—¥å¿—è¿›è¡Œæ•…éšœæ’é™¤ã€‚