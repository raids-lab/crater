---
title: æœ€å°åŒ–ãƒ‡ãƒ—ãƒ­ã‚¤
description: ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€Kind ã‚’ä½¿ç”¨ã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«ã§ Crater ç’°å¢ƒã‚’è¿…é€Ÿã«æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã‚’ã‚¬ã‚¤ãƒ‰ã—ã¾ã™ã€‚Crater ã¯ Kubernetes ãƒ™ãƒ¼ã‚¹ã®åˆ†æ•£ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã‚ã‚Šã€æœ¬ã‚¬ã‚¤ãƒ‰ã§ã¯ Kind ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ä½œæˆã‹ã‚‰ Crater ã®å¿…è¦ãªå„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ‡ãƒ—ãƒ­ã‚¤ã«è‡³ã‚‹ã¾ã§ã®å®Œå…¨ãªæ‰‹é †ã‚’ã‚«ãƒãƒ¼ã—ã¦ã„ã¾ã™ã€‚
---

## 1. ç’°å¢ƒæº–å‚™

### 1.1 Kind ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

<Callout type="info">
å‚è€ƒãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼šhttps://kind.sigs.k8s.io/docs/user/quick-start/
</Callout>

```bash
# Kindã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.20.0/kind-linux-amd64
chmod +x ./kind
sudo mv ./kind /usr/local/bin/kind
```

<Callout type="info">
    ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã®å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€`sudo` ã‚’ä½¿ç”¨ã™ã‚‹ã‹ã€Kind ã‚’æ›¸ãè¾¼ã¿å¯èƒ½ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã¦ãã ã•ã„ã€‚
</Callout>

### 1.2 kubectl ã¨ Helm ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# kubectlã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
chmod +x kubectl
sudo mv kubectl /usr/local/bin/

# Helmã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash
```

## 2. Kind ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ä½œæˆ

### 2.1 ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ

<Callout type="info">
å‚è€ƒãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼šhttps://kind.sigs.k8s.io/docs/user/ingress/
</Callout>

```yaml
# kind-cluster.yaml
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
  - role: control-plane
  - role: worker
    extraPortMappings:
    - containerPort: 80
      hostPort: 8080
      protocol: TCP
    - containerPort: 443
      hostPort: 8443
      protocol: TCP
```

<Callout type="info">
    ãƒãƒ¼ãƒˆãƒãƒƒãƒ”ãƒ³ã‚°ã®è¨­å®šã«ã‚ˆã‚Šã€ãƒ›ã‚¹ãƒˆã‹ã‚‰ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å†…ã®ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ç‰¹ã« Ingress ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã«ãŠã„ã¦é‡è¦ã§ã™ã€‚
</Callout>

### 2.2 ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ä½œæˆ

```bash
kind create cluster --config kind-cluster.yaml
```

**æœŸå¾…ã•ã‚Œã‚‹çµæœï¼š**
```
Creating cluster "kind" ...
 âœ“ Ensuring node image (kindest/node:v1.27.3) ğŸ–¼
 âœ“ Preparing nodes ğŸ“¦ ğŸ“¦
 âœ“ Writing configuration ğŸ“œ
 âœ“ Starting control-plane ğŸ•¹ï¸
 âœ“ Installing CNI ğŸ”Œ
 âœ“ Installing StorageClass ğŸ’¾
 âœ“ Joining worker nodes ğŸšœ
Set kubectl context to "kind-kind"
You can now use your cluster with:
kubectl cluster-info --context kind-kind
```

## 3. Kind ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ç”¨ã® Ingress-Nginx ã®ãƒ‡ãƒ—ãƒ­ã‚¤

<Callout type="info">
    å‚è€ƒãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼šhttps://kind.sigs.k8s.io/docs/user/ingress/
</Callout>

```bash
kubectl apply -f https://kind.sigs.k8s.io/examples/ingress/deploy-ingress-nginx.yaml
```

**ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®ç¢ºèªï¼š**
```bash
kubectl wait --namespace ingress-nginx \
  --for=condition=ready pod \
  --selector=app.kubernetes.io/component=controller \
  --timeout=90s
```

## 4. PostgreSQL ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ‡ãƒ—ãƒ­ã‚¤

<Callout type="info">
    å‚è€ƒãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼šhttps://artifacthub.io/packages/helm/bitnami/postgresql
</Callout>

```bash
# åå‰ç©ºé–“ã®ä½œæˆ
kubectl create namespace crater-system

# ç¾åœ¨ã®åå‰ç©ºé–“ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®è¨­å®š
kubectl config set-context --current --namespace=crater-system

# Bitnami Helmãƒªãƒã‚¸ãƒˆãƒªã®è¿½åŠ 
helm repo add bitnami https://charts.bitnami.com/bitnami

# PostgreSQLã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
helm install crater-postgresql bitnami/postgresql -n crater-system
```

**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å–å¾—ï¼š**
```bash
export POSTGRES_PASSWORD=$(kubectl get secret --namespace crater-system crater-postgresql -o jsonpath="{.data.postgres-password}" | base64 -d)
echo "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: $POSTGRES_PASSWORD"
```

<Callout type="info">
    ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’é©åˆ‡ã«ä¿å­˜ã—ã¦ãã ã•ã„ã€‚å¾Œç¶šã® Crater ã®ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«å¿…è¦ã«ãªã‚Šã¾ã™ã€‚
</Callout>

## 5. Volcano ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ã®ãƒ‡ãƒ—ãƒ­ã‚¤

<Callout type="info">
    å‚è€ƒãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼šhttps://volcano.sh/jp/docs/v1.11.0/installation/
</Callout>

```bash
# Volcano Helmãƒªãƒã‚¸ãƒˆãƒªã®è¿½åŠ 
helm repo add volcano-sh https://volcano-sh.github.io/helm-charts

# åå‰ç©ºé–“ã®ä½œæˆã¨Volcanoã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
helm install volcano volcano-sh/volcano -n volcano-system --create-namespace
```

**ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®ç¢ºèªï¼š**
```bash
kubectl get pods -n volcano-system
```

**æœŸå¾…ã•ã‚Œã‚‹çµæœï¼š**
```
NAME                                   READY   STATUS    RESTARTS   AGE
volcano-admission-xxxxxxxxx-xxxxx     1/1     Running   0          1m
volcano-controllers-xxxxxxxx-xxxxx    1/1     Running   0          1m
volcano-scheduler-xxxxxxxx-xxxxx      1/1     Running   0          1m
```

## 6. NFS ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

<Callout type="info">
    å‚è€ƒãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼šhttps://github.com/kubernetes-sigs/nfs-ganesha-server-and-external-provisioner
</Callout>

```bash
# NFSãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒŠãƒ¼Helmãƒªãƒã‚¸ãƒˆãƒªã®è¿½åŠ 
helm repo add nfs-ganesha-server-and-external-provisioner https://kubernetes-sigs.github.io/nfs-ganesha-server-and-external-provisioner/

# NFSã‚µãƒ¼ãƒãƒ¼ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒŠãƒ¼ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
helm install nfs-provisioner nfs-ganesha-server-and-external-provisioner/nfs-server-provisioner -n nfs-system --create-namespace
```

**ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ãƒ©ã‚¹ã®ç¢ºèªï¼š**
```bash
kubectl get storageclass
```

**æœŸå¾…ã•ã‚Œã‚‹çµæœï¼š**
```
NAME   PROVISIONER                                       RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE
nfs    cluster.local/nfs-provisioner-nfs-server-provisioner   Delete          Immediate           true                   1m
```

## 7. Crater ã®ãƒ‡ãƒ—ãƒ­ã‚¤

### 7.1 Crater Helm Chart ã®å€¤ãƒ•ã‚¡ã‚¤ãƒ«ã®å–å¾—

```bash
helm show values oci://ghcr.io/raids-lab/crater --version 0.1.0 > values.yaml
```

### 7.2 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã®è¨­å®š

`values.yaml`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¦ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šæƒ…å ±ã‚’è¨­å®šã—ã¾ã™ï¼š

```yaml
postgres:
  host: crater-postgresql.crater-system.svc.cluster.local
  port: 5432
  dbname: postgres
  user: postgres
  password: "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"  # å®Ÿéš›ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«ç½®ãæ›ãˆã¦ãã ã•ã„
  sslmode: disable
  TimeZone: Asia/Shanghai
```

### 7.3 Crater ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
helm install crater oci://ghcr.io/raids-lab/crater --version 0.1.0 -n crater-system -f values.yaml
```

**ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®ç¢ºèªï¼š**
```bash
kubectl get pods -n crater-system
```

<Callout type="success">
    ã™ã¹ã¦ã® Pod ãŒ Running çŠ¶æ…‹ã§ã‚ã‚Œã°ã€Crater ç’°å¢ƒã®æ§‹ç¯‰ã¯æˆåŠŸã—ã¦ã„ã¾ã™ï¼
</Callout>

## 8. Crater ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹

### 8.1 ã‚¢ã‚¯ã‚»ã‚¹å…ˆã®å–å¾—

```bash
kubectl get ingress -n crater-system
```

### 8.2 ãƒ­ãƒ¼ã‚«ãƒ« hosts ã®è¨­å®šï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰

ãƒ­ãƒ¼ã‚«ãƒ«ã® Kind ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€`/etc/hosts`ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

```
127.0.0.1 crater.example.com
```

### 8.3 Web ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹

ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ï¼šï¼ˆIngress ã®è¨­å®šã«å¿œã˜ã¦å¤‰æ›´å¯èƒ½ï¼‰ï¿½ï¿½å®šã«å¿œã˜ã¦å¤‰æ›´å¯èƒ½ï¼‰

## 9. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### 9.1 ä¸€èˆ¬çš„ãªå•é¡Œ

<Callout type="warn">
    **å•é¡Œï¼š** Pod ãŒèµ·å‹•ã§ããªã„ã€ã¾ãŸã¯ç¶™ç¶šçš„ã«å†èµ·å‹•ã™ã‚‹
</Callout>

**è§£æ±ºç­–ï¼š**
```bash
# Podãƒ­ã‚°ã®ç¢ºèª
kubectl logs <pod-name> -n crater-system

# Podã®è©³ç´°æƒ…å ±ã®ç¢ºèª
kubectl describe pod <pod-name> -n crater-system
```

<Callout type="warn">
    **å•é¡Œï¼š** ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã«å¤±æ•—
</Callout>

**è§£æ±ºç­–ï¼š**
```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚µãƒ¼ãƒ“ã‚¹ã®çŠ¶æ…‹ã®ç¢ºèª
kubectl get svc -n crater-system | grep postgres

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã®ãƒ†ã‚¹ãƒˆ
kubectl run postgres-test --rm -it --image=postgres:13 --restart=Never -- \
  psql -h crater-postgresql.crater-system.svc.cluster.local -U postgres
```

## 10. ç’°å¢ƒã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

```bash
# Kindã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®å‰Šé™¤
kind delete cluster

# ç‰¹å®šã®ãƒªã‚½ãƒ¼ã‚¹ã®å‰Šé™¤
helm uninstall crater -n crater-system
helm uninstall crater-postgresql -n crater-system
helm uninstall volcano -n volcano-system
helm uninstall nfs-provisioner -n nfs-system
```

<Callout type="warn">
    ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®å‰Šé™¤ã¯ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã€‚é‡è¦ãªãƒ‡ãƒ¼ã‚¿ã¯ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚
</Callout>

## çµè«–

æœ¬ã‚¬ã‚¤ãƒ‰ã«å¾“ã£ã¦ã€Kind ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ä¸Šã«å®Œå…¨ãª Crater ç’°å¢ƒã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã—ãŸã€‚å«ã¾ã‚Œã‚‹ä¸»ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼š

- âœ… Kind Kubernetes ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼
- âœ… Ingress-Nginx ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼
- âœ… PostgreSQL ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- âœ… Volcano ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©
- âœ… NFS ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒŠãƒ¼
- âœ… Crater ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ 

ä»Šã‚„ã€Crater ã‚’ä½¿ç”¨ã—ã¦åˆ†æ•£ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚¿ã‚¹ã‚¯ã‚’é–‹å§‹ã§ãã¾ã™ï¼ä½•ã‹å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã€ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚