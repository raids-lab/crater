---
title: "CloudNativePG デプロイガイド"
description: "Crater に OpenEBS ストレージを使用した CloudNativePG Operator を使って PostgreSQL を統合します。"
---

## 概要

Crater はユーザー セッション、ジョブメタデータ、スケジューリング状態、プラットフォーム構成を管理するために、**PostgreSQL** をバックエンドデータベースとして使用しています。

生産環境レベルでの Kubernetes ネイティブな PostgreSQL 管理を実現するために、[CloudNativePG Operator](https://cloudnative-pg.io/) を採用しています。これは以下を提供します:

- CRD を用いた PostgreSQL クラスターの宣言的管理  
- 自動的な高可用性、バックアップ、フェイルオーバー  
- Kubernetes RBAC、ストレージ、スケジューリングとの密接な統合

当社のデプロイでは、CloudNativePG を **OpenEBS Local PV** と統合し、ストレージとして使用することで、高速なローカルディスク性能と完全なデータライフサイクル管理を実現しています。

## なぜ CloudNativePG を選んだのか?

CloudNativePG を選んだ理由は以下の通りです:

- CNCF 孵化プロジェクトであり、強いコミュニティサポートがあります。  
- **PostgreSQL の構成** と **Kubernetes ネイティブなオーケストレーション** の間に明確な分離を提供します。  
- PostgreSQL のデプロイを簡素化しながら、高度な調整にも柔軟に対応できます。

Crater スタックでは、各 PostgreSQL クラスターはカスタム `Cluster` リソースとして定義され、オペレーターによって管理されます。

## ストレージ設定

データベースは OpenEBS Local PV（[`openebs.md`](./openebs.md) に記載されているとおり）をバックエンドとして使用するローカル永続ストレージを使用しています。

この構成により、以下の利点があります:

- 単一ノードワークロードに対して高 IOPS と低レイテンシを提供  
- 予測可能なノードローカルスケジューリング  
- クリーンで宣言的なボリュームライフサイクル管理

CloudNativePG をインストールする前に、OpenEBS Local PV が正しくインストール・動作していることを確認してください。

## 事前条件

- `kubectl` と `helm` がインストールされていること  
- OpenEBS Local PV がインストールされていること

## インストール

オペレーターのインストール用にカスタマイズされた Helm 設定を提供しています。

📦 Helm 値: [`deployments/cloudnative-pg/values.yaml`](../deployments/cloudnative-pg/values.yaml)  
📖 詳細ガイド: [`deployments/cloudnative-pg/README.md`](../deployments/cloudnative-pg/README.md)