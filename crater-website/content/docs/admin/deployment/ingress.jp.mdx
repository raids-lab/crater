---
title: Ingress-NGINX é…ç½®ã‚¬ã‚¤ãƒ‰
description: Crater ã¯ã€Ingress-NGINX ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®å¤–éƒ¨ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç®¡ç†ã—ã€HTTP ãŠã‚ˆã³ HTTPS ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã®ä¸»è¦ãªã‚¤ãƒ³ã‚°ãƒ¬ã‚¹ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦æ©Ÿèƒ½ã—ã¾ã™ã€‚
---

## é…ç½®

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³1: LoadBalancer ãªã— (ä¾‹: ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ãƒ¡ã‚¿ãƒ«ã¾ãŸã¯é–‹ç™ºã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼)

LoadBalancer ã‚µãƒ¼ãƒ“ã‚¹ã‚¿ã‚¤ãƒ—ãŒåˆ©ç”¨ã§ããªã„ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã§ã¯ã€`hostNetwork` ãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã®ãŒæ¨å¥¨ã•ã‚Œã¾ã™ã€‚

```bash
helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
helm repo update

helm upgrade --install ingress-nginx ingress-nginx \
  --repo https://kubernetes.github.io/ingress-nginx \
  --namespace ingress-nginx \
  --create-namespace \
  --version 4.11.3 \
  --set controller.image.registry="crater-harbor.act.buaa.edu.cn/registry.k8s.io" \
  --set controller.admissionWebhooks.patch.image.registry="crater-harbor.act.buaa.edu.cn/registry.k8s.io" \
  --set controller.hostNetwork=true \
  --set controller.dnsPolicy=ClusterFirstWithHostNet \
  --set controller.healthCheckHost="10.109.80.4" \
  --set 'controller.nodeSelector.kubernetes\.io/hostname=cnode1' \
  --set "controller.tolerations="
```

ğŸ”§ ãƒãƒ¼ãƒ‰ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã€ãƒˆãƒ¬ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€healthCheckHost ã‚’ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ãƒãƒ¼ãƒ‰æ§‹æˆã«åˆã‚ã›ã¦èª¿æ•´ã—ã¦ãã ã•ã„ã€‚

ã‚ªãƒ—ã‚·ãƒ§ãƒ³2: MetalLB ã§ã®ä½¿ç”¨ (Crater ãŒæ¨å¥¨)
æˆ‘ã€…ã®ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã§ã¯ã€Crater ã¯ MetalLB ã‚’ä½¿ç”¨ã—ã¦ãƒ¬ã‚¤ãƒ¤ãƒ¼2ãƒ¢ãƒ¼ãƒ‰ã§å†…éƒ¨IPã‚’å‰²ã‚Šå½“ã¦ã¦ã„ã¾ã™ã€‚Ingress ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã¯ã€LoadBalancer ã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã€å†…éƒ¨IPã‚’å–å¾—ã—ã¾ã™ã€‚

```bash
helm upgrade --install ingress-nginx ingress-nginx/ingress-nginx \
  --namespace ingress-nginx \
  --create-namespace \
  --version 4.11.3 \
  --set controller.image.registry="crater-harbor.act.buaa.edu.cn/registry.k8s.io" \
  --set controller.admissionWebhooks.patch.image.registry="crater-harbor.act.buaa.edu.cn/registry.k8s.io" \
  --set controller.allowSnippetAnnotations=true
```

ğŸ“Œ ã“ã®è¨­å®šã¯ã€MetalLB ã®ãƒ—ãƒ¼ãƒ«ã‹ã‚‰å†…éƒ¨IPã‚’ä½¿ç”¨ã—ã€ä¿¡é ¼ã§ãã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã§ã®ã‚µãƒ¼ãƒ“ã‚¹ç™ºè¦‹ (ä¾‹: å¤§å­¦ã®ã‚¤ãƒ³TRANET) ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚

å¤–éƒ¨IPã®å‰²ã‚Šå½“ã¦ã‚’ç¢ºèªã™ã‚‹ã«ã¯:
```bash
kubectl get svc -n ingress-nginx
```

ä¾‹:

```bash
NAME                       TYPE           EXTERNAL-IP       PORT(S)
ingress-nginx-controller   LoadBalancer   192.168.100.243   80:31234/TCP,443:31235/TCP
```

# ãƒãƒ¼ã‚¸ãƒ§ãƒ³äº’æ›æ€§ã«é–¢ã™ã‚‹æ³¨æ„
ç¾åœ¨ã€Ingress-NGINX ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ `4.11.3` ã«å›ºå®šã—ã¦ã„ã¾ã™ã€‚ãªãœãªã‚‰ã€Crater ã® Ingress ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ `4.12.0` ä»¥é™ã¨ã®äº’æ›æ€§ãŒã¾ã ç¢ºç«‹ã•ã‚Œã¦ã„ãªã„ãŸã‚ã§ã™ã€‚æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒªãƒ©ã‚¤ãƒˆã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ã€‚

# è§£é™¤
Ingress ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’å‰Šé™¤ã™ã‚‹ã«ã¯:

```bash
helm uninstall ingress-nginx -n ingress-nginx
```
# å‚è€ƒè³‡æ–™

* [Ingress-NGINX Helm Chart](https://github.com/kubernetes/ingress-nginx)

* [Crater äº’æ›æ€§ã«é–¢ã™ã‚‹ãƒ¡ãƒ¢](../README.md)