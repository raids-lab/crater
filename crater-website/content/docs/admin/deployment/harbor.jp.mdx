---
title: Harbor のデプロイメントガイド
description: Crater は、クラスター内でイメージのビルド、ストレージ、セキュアな配布をサポートするために、内部の Harbor レジストリに依存しています。

---

## デプロイメント

デプロイメントには[公式の Harbor Helm Chart](https://github.com/goharbor/harbor-helm)の使用をお勧めします。基本的な例：

```bash
helm repo add harbor https://helm.goharbor.io
helm pull harbor/harbor --version 1.14.0
# 必要に応じてvalues.yamlを編集してください（下記を参照）
helm install crater-harbor harbor/harbor -f values.yaml -n harbor-system --create-namespace
```

## 注意：以下の点を確認してください：

ドメイン名（例：crater-harbor.act.buaa.edu.cn）はクラスターまたは内部 DNS 内で解決可能である必要があります。

有効な TLS 設定があるか、または HTTP での公開のために expose.tls.enabled=false を設定している必要があります。

## 設定のヒント
values.yaml で externalURL を正しく設定してください：
```yaml
externalURL: https://crater-harbor.act.buaa.edu.cn
```
適切なクラス（ingress-nginx）とホスト名を持つイングレスを設定してください。

テスト用に内部証明書を使用するか、TLS を無効にしてください：
```yaml
expose:
  tls:
    enabled: false
```

## イメージプルシークレット
Crater コンポーネントが Harbor からイメージをプルできるようにするには：
```bash
kubectl create secret docker-registry crater-harbor-auth \
  --docker-server=crater-harbor.act.buaa.edu.cn \
  --docker-username=<user> \
  --docker-password=<password> \
  -n <target-namespace>
```
その後、このシークレットを pod.spec.imagePullSecrets で参照してください。

## Harbor プロジェクト構造
プロジェクトは以下の通りに整理されています：
| プロジェクト       | 目的                    |
| ------------- | -------------------------- |
| crater/base   | ベース OS とユーティリティ      |
| crater/jobs   | ユーザーが送信したジョブイメージ |
| crater/charts | Helm チャートのミラー        |
| crater/models | 推論用の大規模モデル        |

## Crater との統合
ほとんどのシステムコンポーネント（例：gpu-operator, ingress-nginx, prometheus）は、Harbor ミラーを使用するように事前に設定されています。

イメージのパスは以下のようになります：
```ruby
crater-harbor.act.buaa.edu.cn/crater/<component>:<tag>
```
Helm チャートのカスタマイズ時に image.repository と imagePullSecrets を更新してください。

## 参考資料
* [Harbor ドキュメント](https://goharbor.io/docs/)