---
title: Volcano 統合ガイド
description: Crater が Volcano バッチスケジューラを使用して、複数のラボの GPU リソース管理および分散ワークロードをどのように行うか。
---

## 概要

[Volcano](https://volcano.sh/en/) は、AI/ML トレーニング、ビッグデータ、科学計算などの高パフォーマンスワークロード向けに設計されたバッチスケジューリングシステムです。Crater では、Volcano を使用して、複数のラボとユーザー間で公平かつプリエムティブな方法で GPU スケジューリングを管理します。

---

## なぜ Volcano なのか？

Crater では、Volcano の豊富なスケジューリング機能、拡張性のあるプラグインシステム、そして **分散トレーニング**、 **公平なリソース共有**、 **ジョブレベルの制御** へのネイティブサポートがあるため、Volcano を採用しました。

Crater は以下の Volcano コンポーネントを活用しています：

- **Queue & Quota CRDs** – ラボ間での細かい GPU リソース割り当て
- **Preemption (Capacity Plugin)** – ラボとユーザー間でのプリエムティブなスケジューリング
- **Job CRD & Plugins** – 分散タスクへのネイティブサポート
- **Node ordering, job ordering, gang scheduling** など

---

## ラボ指向のキュー設計

Crater は、さまざまな研究ラボが GPU クラスターを共有する学術的なマルチテナントシナリオを対象としています。リソースの公平性を管理するために以下を行います：

- 各ラボに対して **`Queue`** を作成します（例：`lab-a`, `lab-b`）
- 各ユーザーはそれぞれのラボのキューに割り当てられます
- 対応する **`ResourceQuota`** がラボの保証された GPU 容量を定義します
- Volcano の **`capacity` プラグイン** が競合が発生したときにプリエムションポリシーを実施します

この設計により以下が可能になります：

- ラボ間の明確な **リソース境界**
- **柔軟なクォータ** による機会的な共有
- **優先度に基づくプリエムション** によるリソース不足の回避

---

## 分散ジョブのサポート

Crater は Volcano の [Job CRD](https://volcano.sh/en/docs/job-tutorial/) を利用して以下をサポートしています：

- 分散 PyTorch、TensorFlow、MPI ワークロード
- ガングスケジューリングとジョブ依存関係
- ライフサイクル管理（開始、一時停止、削除）

また、以下のスケジューリングプラグインを Volcano で有効にしております：

- `gang` – 同じジョブ内のポッドを同時に開始します
- `svc` – 分散トレーニング用にヘッドレスサービスを生成します
- `priority` – ユーザー/ジョブの優先度を尊重します
- `numa-aware` – 必須ではありませんが、パフォーマンスを重視するワークロード用に

---

## VLLM との互換性

現在、[vLLM](https://github.com/vllm-project/vllm) 推論エンジンをカスタムの `Job` CRD を用いて Volcano 下で実行するように調整しています。これにより、大規模モデルの推論を、統合されたスケジューリング、キューイング、クォータ実行付きの分散ワークロードとして扱うことができます。

---

## LLaMA Factory との互換性

また、ACT Lab が開発したもう一つのファインチューニングプロジェクトである [LLaMA Factory](https://github.com/hiyouga/LLaMA-Factory) へのサポート拡張にも積極的に取り組んでいます。統合の取り組みは、Volcano の `Job` CRD を利用した分散ファインチューニングジョブの実行を可能にし、GPU トポロジ、リソースクォータ、ジョブオーケストレーションにおけるスケジューリング認識を実現することを目的としています。

---

## インストールに関する注意点

Crater の事前に設定された値を使用して Helm 経由で Volcano をインストールすることを推奨します。

📦 Helm 値：[`deployments/volcano/values.yaml`](../deployments/volcano/values.yaml)  
📖 詳細ガイド：[`deployments/volcano/README.md`](../deployments/volcano/README.md)