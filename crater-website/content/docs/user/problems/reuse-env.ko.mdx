---
title: Slurm 클러스터에서 환경 이전 가이드
description: 기존 Conda 환경 재사용 또는 Python 환경 재구성

---

## 개요

계산 클러스터 업그레이드 또는 이전 과정에서 환경 이전은 핵심 단계입니다. 본 문서는 기존 Slurm 클러스터 환경을 새로운 계산 플랫폼으로 이전하는 방법을 안내합니다. 본문에서는 두 가지 주요 방법을 소개합니다: 기존 Conda 환경을 직접 재사용하는 방법과 기존 환경을 기반으로 Python 환경을 재구성하는 방법.

## 1. 기존 Conda 환경 재사용

<Callout title="경고" type="warn">
기존 Conda 환경을 직접 재사용할 수 있지만, 다음 요소를 신중하게 고려해야 합니다:

- **성능 영향**: Docker 컨테이너 내에서 Python 환경을 다시 설치하는 경우 일반적으로 더 나은 실행 효율성을 보입니다.
- **호환성 문제**: 환경을 직접 재사용하면 경로 종속성 문제가 발생할 수 있습니다.
- **환경 깔끔함**: 기존 환경에는 더 이상 사용되지 않는 의존성 패키지가 포함될 수 있습니다.

</Callout>

1. **경로 조정**:
   `/home/{username}`을 `/home/LAB/{username}`으로 변경하여 Slurm 클러스터와 맞추고 경로 하드코딩 문제를 해결합니다. 환경을 재사용하지 않으려면 이 단계를 건너뛸 수 있습니다.

   ![mount](./img/mount.webp)

2. **환경 활성화**:
   다음 명령어와 유사하게 기존 환경을 활성화합니다:

   ```bash
   export USERNAME=liyilong
   export PATH=/home/LAB/${USERNAME}/miniconda3/bin:${PATH}
   source /home/LAB/${USERNAME}/miniconda3/etc/profile.d/conda.sh
   export PATH=$CONDA_DIR/bin:${PATH}
   ```

3. **환경 검증**:
   다음 명령어로 환경이 성공적으로 활성화되었는지 확인합니다:

   ```bash
   conda activate
   ```

## 2. 기존 환경을 기반으로 Python 환경 재구성

<Callout title="장점" type="info">

- **환경 순수성**: 더 이상 사용되지 않는 의존성을 제거할 수 있습니다.
- **성능 최적화**: 새 설치는 일반적으로 더 나은 성능을 제공합니다.
- **유지보수성**: 명확한 의존성 목록은 후속 유지보수에 도움이 됩니다.

</Callout>

1. **Requirements 파일 생성**:
   프로젝트 디렉토리를 스캔하여 정확한 의존성 목록을 생성합니다:

   ```bash
   pip install pipreqs
   pipreqs /path/to/project --encoding=utf8 --force
   ```

2. **의존성 목록 최적화**:

   - 생성된 requirements.txt 파일을 수동으로 확인합니다.
   - 더 이상 사용되지 않는 의존성을 제거합니다.
   - 중요한 의존성의 버전 번호를 고정합니다.

3. **새로운 환경 생성**: 이미지 제작 섹션을 참조하여 여러 방식으로 새 환경을 생성할 수 있습니다.

## 결론

우리는 두 번째 방법 (환경 재구성) 을 우선적으로 권장합니다. 초기 작업이 더 많지만, 장기적인 유지보수성과 성능 측면에서 더 나은 결과를 가져옵니다. 시간이 촉박한 경우, 첫 번째 방법 (환경 재사용) 은 임시 해결책으로 사용할 수 있지만, 이후에 환경을 다시 구축하는 것이 좋습니다.

> 주의: 환경 이전 시 반드시 백업을 수행하고, 모든 작업 단계를 기록하여 문제가 발생했을 때 빠르게 롤백할 수 있도록 해야 합니다.